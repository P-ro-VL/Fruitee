<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Fruitee</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='cart.css') }}"
    />

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const user = document.getElementById('username');
        user.addEventListener('click', function () {
          const result = confirm(
            'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?'
          );
          if (result) {
            fetch('/logout').then((response) => {
              if (response.ok) {
                window.location.href = '/';
              } else {
                alert('ƒêƒÉng xu·∫•t kh√¥ng th√†nh c√¥ng');
              }
            });
          }
        });

        const minusButtons = document.querySelectorAll('.minus');
        const plusButtons = document.querySelectorAll('.plus');
        const deleteButtons = document.querySelectorAll('.delete-btn');

        minusButtons.forEach((button) => {
          button.addEventListener('click', function () {
            const productId = this.id;

            fetch('/cart?action=remove&product_id=' + productId, {
              method: 'POST',
            })
              .then((response) => {
                if (response.status == 200) {
                  window.location.href = '/cart';
                } else {
                  alert('X√≥a s·∫£n ph·∫©m kh√¥ng th√†nh c√¥ng');
                }
              });
          });
        });

        plusButtons.forEach((button) => {
          button.addEventListener('click', function () {
            const productId = this.id;

            fetch('/cart?action=add&product_id=' + productId, {
              method: 'POST',
            })
              .then((response) => {
                if (response.status == 200) {
                  window.location.href = '/cart';
                } else {
                  alert('Th√™m s·∫£n ph·∫©m kh√¥ng th√†nh c√¥ng');
                }
              });
          });
        });

        deleteButtons.forEach((button) => {
          button.addEventListener('click', function () {
          });
        });

        const applyCoupon = document.getElementById('apply-coupon');
        applyCoupon.addEventListener('click', function () {
          const couponCode = document.getElementById('coupon-code').value;
          if (!couponCode) {
            alert('Vui l√≤ng nh·∫≠p m√£ gi·∫£m gi√°');
            return;
          }

          window.location.href = '/cart?coupon_code=' + couponCode;
        });

        const makePayment = document.getElementById('make-payment');
        makePayment.addEventListener('click', function () {
          const totalPrice = document.getElementById('total_price').innerText;
          fetch('/payment', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 'total_price': totalPrice }),
          })
            .then((response) => {
              window.location.href = '/payment';
            });
        });
      });
    </script>
  </head>
  <body style="background-color: #f7f4eb">
    <div class="flex space-between items-center px-10 py-1">
      <a style="color: #80b600; font-size: 1.25rem" class="bold">Fruitee</a>
      <div class="w-1_4 flex space-evenly">
        <a class="pointer" href="/">Trang ch·ªß</a>
        <a class="bold pointer" href="/shop">C·ª≠a h√†ng</a>
        <a class="pointer" href="/about">V·ªÅ ch√∫ng t√¥i</a>
      </div>
      <div class="flex items-center">
        {% if user %}
        <a id="username" class="pointer">{{ user }}</a>
        <img
          src="{{ url_for('static', filename='svg/cart.svg') }}"
          class="w_2 h_2"
          style="margin-right: 1.5rem; margin-left: 1rem;"
        />
        {% else %}
        <a class="pointer" href="/login">ƒêƒÉng nh·∫≠p</a>
        {% endif %}
      </div>
    </div>
  </body>

  <div class="w-full center flex-col items-center" style="margin-top: 5rem">
    <div class="flex-col items-center">
      <p
        style="font-size: 2.5rem; color: #80b600; width: fit-content"
        class="bold"
      >
        Gi·ªè h√†ng c·ªßa b·∫°n
      </p>
    </div>

    <div
      class="w-full flex center"
      style="height: fit-content; margin-top: 2rem"
    >
      <div
        style="
          width: 70%;
          height: auto;
          border-radius: 12px;
          border: 3px solid rgba(39, 39, 39, 0.2);
          padding: 10px 30px;
        "
      >
        <div class="cart-table">
          <table>
            <tr>
              <th>S·∫£n ph·∫©m</th>
              <th>ƒê∆°n gi√°</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>Th√†nh ti·ªÅn</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>

            {% for product in cart %}
            <tr>
              <td>{{ product.name }}</td>
              <td>{{ product.price }}ƒë</td>
              <td class="quantity flex center">
                <button id="{{ product.id }}" class="minus">-</button> {{ product.quantity }} <button id="{{ product.id }}" class="plus">+</button>
              </td>
              <td>{{ product.total_price }}ƒë</td>
              <td><button class="delete-btn">üóë</button></td>
            {% endfor %}
          </table>
        </div>
      </div>
      <div style="width: 10px"></div>
      <div
        style="
          height: 25rem;
          width: 30%;
          border-radius: 12px;
          border: 3px solid rgba(39, 39, 39, 0.2);
        "
      >
        <div class="order-summary" style="padding: 10px 30px">
          <h3>T·ªïng gi·ªè h√†ng</h3>
          <div class="flex center items-center">
            <input id="coupon-code" type="text" placeholder="M√£ gi·∫£m gi√°" />
            <button id="apply-coupon" style="margin-left: 8px" class="apply-button">
              √Åp d·ª•ng
            </button>
          </div>
          <div style="margin-top: 20px">
            <div class="row flex space-between">
              <p>T·∫°m t√≠nh:</p>
              <strong>{{ total_cart }} USD</strong>
            </div>
            <div class="row flex space-between">
              <p>Gi·∫£m gi√°:</p>
              <strong>- {{ discount }} USD ({{ coupon_name }})</strong>
            </div>
            <div class="row flex space-between">
              <p>Ph√≠ v·∫≠n chuy·ªÉn:</p>
              <strong>{{ shipping_fee }} USD</strong>
            </div>
            <hr />
            <div class="row flex space-between">
              <p>T·ªïng c·ªông:</p>
              <strong style="font-size: 1.25rem">{{ total_price }} USD</strong>
            </div>
            <hidden id="total_price">{{ total_price }}</hidden>
          </div>
          <button id="make-payment" class="checkout-btn" style="margin-top: 20px">
            <b>Thanh to√°n ngay</b>
          </button>
        </div>
      </div>
    </div>
  </div>
</html>
